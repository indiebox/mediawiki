developer=http://wikimediafoundation.org/
url=${developer}
maintainer=http://indiecomputing.com/
pkgname=$(basename $(pwd))
_majorpkgver=1.29
pkgver=${_majorpkgver}.2
pkgrel=1
pkgdesc="The wiki that Wikipedia runs on"
arch=('any')
license=("GPL")
source=("http://releases.wikimedia.org/mediawiki/${_majorpkgver}/mediawiki-${pkgver}.tar.gz")
releasepage=("https://www.mediawiki.org/wiki/MediaWiki")
depends=(
    'php'
    'smtp-server'
)
options=('!strip')
sha512sums=('c4e04c4fb665c3d8299f3e03e608904aaf0e06381240c7259813eb670c3e32cde919353dd19993250cf49be81d604ac5f6d468bc563116a4b268e5011d34119f')

package() {
# Manifest
    mkdir -p $pkgdir/var/lib/ubos/manifests
    install -m644 $startdir/ubos-manifest.json $pkgdir/var/lib/ubos/manifests/${pkgname}.json

# Icons
    mkdir -p $pkgdir/srv/http/_appicons/$pkgname
    install -m644 $startdir/appicons/{72x72,144x144}.png $pkgdir/srv/http/_appicons/$pkgname/

# Code
    mkdir -p $pkgdir/usr/share/${pkgname}/bin
    install -m755 $startdir/bin/{create-admin,symlink-logo,upgrade}.pl $pkgdir/usr/share/${pkgname}/bin/

# Templates
    mkdir -p $pkgdir/usr/share/${pkgname}/tmpl
    install -m644 $startdir/tmpl/{AdminSettings.php.tmpl,LocalSettings.php.tmpl,htaccess.pl} $pkgdir/usr/share/${pkgname}/tmpl/

# Source
    mkdir -p $pkgdir/usr/share/${pkgname}/mediawiki
    for f in $startdir/src/mediawiki-${pkgver}/*; do
        [ "$(basename $f)" != "tests" ] && [ "$(basename $f)" != "docs" ] && cp -dr --no-preserve=ownership $f $pkgdir/usr/share/${pkgname}/mediawiki/
    done

# Cache
    mkdir -p $pkgdir/var/cache/${pkgname}
}
